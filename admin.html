<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Sewer District 3 Pump Station Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; }
    h1 { color: #333; }
    #stationList { list-style-type: none; padding: 0; }
    #stationList li {
      background: #fff;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .station-actions button {
      margin-left: 10px;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .edit-btn { background-color: #ffc107; }
    .delete-btn { background-color: #dc3545; color: white; }
    #addStationForm {
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      margin-top: 20px;
    }
    #addStationForm input {
      width: calc(100% - 22px);
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    #addStationForm button {
      background: #28a745;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>Pump Station Management</h1>
  <a href="index.html">Back to Map</a>

  <div id="addStationForm">
    <h2>Add New Station</h2>
    <input type="text" id="stationCode" placeholder="Station Code (e.g., A1)">
    <input type="text" id="stationAddress" placeholder="Address">
    <input type="text" id="stationLat" placeholder="Latitude">
    <input type="text" id="stationLon" placeholder="Longitude">
    <button id="addBtn">Add Station</button>
  </div>

  <h2>Existing Stations</h2>
  <ul id="stationList"></ul>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Firebase init
    firebase.initializeApp({
      apiKey:            "AIzaSyBC4ytQPxzKZd1L47Gc5M4FoRYn44C5q9w",
      authDomain:        "sd3ps-map.firebaseapp.com",
      projectId:         "sd3ps-map",
      storageBucket:     "sd3ps-map.appspot.com",
      messagingSenderId: "14976888367",
      appId:             "1:14976888367:web:9ef05a76be1ca780d7e0da",
      measurementId:     "G-HHX1X8KFSF"
    });
    const db = firebase.firestore();

    // DOM refs
    const stationList = document.getElementById('stationList');
    const addBtn = document.getElementById('addBtn');
    const codeInput = document.getElementById('stationCode');
    const addressInput = document.getElementById('stationAddress');
    const latInput = document.getElementById('stationLat');
    const lonInput = document.getElementById('stationLon');

    // Load and display stations
    async function getStations() {
      stationList.innerHTML = '';
      const snapshot = await db.collection('pumpStations').get();
      snapshot.forEach(doc => {
        const station = doc.data();
        const li = document.createElement('li');
        li.innerHTML = `
          <span>
            <strong>${doc.id}</strong> - ${station.address} (${station.lat}, ${station.lon})
          </span>
          <span class="station-actions">
            <button class="edit-btn" data-id="${doc.id}">Edit</button>
            <button class="delete-btn" data-id="${doc.id}">Delete</button>
          </span>
        `;
        stationList.appendChild(li);
      });
    }

    // Add a new station
    addBtn.addEventListener('click', async () => {
      const code = codeInput.value.trim();
      const address = addressInput.value.trim();
      const lat = parseFloat(latInput.value);
      const lon = parseFloat(lonInput.value);

      if (code && address && !isNaN(lat) && !isNaN(lon)) {
        await db.collection('pumpStations').doc(code).set({ address, lat, lon });
        codeInput.value = '';
        addressInput.value = '';
        latInput.value = '';
        lonInput.value = '';
        getStations();
      } else {
        alert('Please fill out all fields correctly.');
      }
    });

    // Handle edit and delete buttons
    stationList.addEventListener('click', async (e) => {
      const target = e.target;
      const id = target.dataset.id;

      if (target.classList.contains('delete-btn')) {
        if (confirm(`Are you sure you want to delete station ${id}?`)) {
          await db.collection('pumpStations').doc(id).delete();
          getStations();
        }
      }

      if (target.classList.contains('edit-btn')) {
        const doc = await db.collection('pumpStations').doc(id).get();
        const station = doc.data();

        const newAddress = prompt('Enter new address:', station.address);
        const newLat = prompt('Enter new latitude:', station.lat);
        const newLon = prompt('Enter new longitude:', station.lon);

        if (newAddress && newLat && newLon) {
          await db.collection('pumpStations').doc(id).update({
            address: newAddress,
            lat: parseFloat(newLat),
            lon: parseFloat(newLon)
          });
          getStations();
        }
      }
    });

    // Initial load
    getStations();
  </script>
</body>
</html>
