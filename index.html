<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sewer District 3 Pump Station Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0066cc">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{margin:0;padding:0}#map{height:100vh}
    #title{position:absolute;top:10px;left:5%;width:90%;max-width:90%;z-index:1000;
      background:white;padding:6px;border-radius:6px;font-size:18px;font-weight:bold;text-align:center}
    #stationSelect{position:absolute;top:60px;left:5%;width:90%;max-width:90%;z-index:1000;
      background:white;padding:6px;border-radius:6px;font-size:14px}
    #installBtn{position:absolute;top:110px;left:5%;z-index:1000;background:#0066cc;color:white;
      padding:8px;border:none;border-radius:4px;font-size:14px}
    @media(min-width:600px){#title{left:50px;width:auto;max-width:400px}#stationSelect{left:50px;width:auto;max-width:300px}
      #installBtn{left:50px}}
  </style>
</head>
<body>
  <div id="title">Sewer District 3 Pump Station Map</div>
  <select id="stationSelect"><option value="">Select Pump Station</option></select>
  <button id="installBtn" style="display:none">Install App</button>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', e => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });
    installBtn.addEventListener('click', () => {
      installBtn.style.display = 'none';
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then(choice => { deferredPrompt = null; });
    });
    if('serviceWorker' in navigator) { navigator.serviceWorker.register('service-worker.js'); }

    const stations = [{"code": "PS#300 AWXIA", "lat": 40.7227675, "lon": -73.23075269999998, "address": "50 South Saxon Avenue, Bay Shore, NY 11706"}, {"code": "PS#301", "lat": 40.6930405, "lon": -73.2790417, "address": "9 Oak Neck Lane, West Islip, NY 11795"}, {"code": "PS#302", "lat": 40.704264, "lon": -73.25481919999999, "address": "33 Girard Ave, Brightwaters, NY 11718"}, {"code": "PS#303", "lat": 40.7058464, "lon": -73.25095590000001, "address": "1 Shore Road East, Brightwaters, NY 11718"}, {"code": "PS#304", "lat": 40.7138133, "lon": -73.24673380000002, "address": "7 Prospect Avenue, Bay Shore, NY 11706"}, {"code": "PS#305", "lat": 40.71697149999999, "lon": -73.24245630000001, "address": "89 Maple Avenue, Bay Shore, NY 11706"}, {"code": "PS#306", "lat": 40.7195939, "lon": -73.2375154, "address": "83 South Montgomery Avenue, Bay Shore, NY 11706"}, {"code": "PS#307", "lat": 40.7145541, "lon": -73.2211747, "address": "600 Ocean Avenue, Islip, NY 11751"}, {"code": "PS#308", "lat": 40.7143538, "lon": -73.1967512, "address": "57 The Helm, East Islip, NY 11730"}, {"code": "PS#309", "lat": 40.66180049999999, "lon": -73.41907880000002, "address": "219 Richmond Avenue, Amityville, NY 11701"}, {"code": "PS#310", "lat": 40.65831480000001, "lon": -73.40030239999999, "address": "Jefferson Rd, Copiague (Amity Harbor), Amityville, NY 11701"}, {"code": "PS#311", "lat": 40.7751554, "lon": -73.2063197, "address": "71 Beech Street, Central Islip, NY 11722"}, {"code": "PS#312", "lat": 40.7872918, "lon": -73.2842493, "address": "Pilgrim State (20 Sagtikos Parkway), Brentwood, NY 11717"}, {"code": "PS#313", "lat": 40.7786667, "lon": -73.1933449, "address": "1 Fairlawn Drive, Central Islip, NY 11722"}, {"code": "PS#314", "lat": 40.75141199999999, "lon": -73.36091099999999, "address": "2 Irving Avenue, Wyandanch, NY 11798"}, {"code": "PS#317-2", "lat": 40.7868774, "lon": -73.406908, "address": "270 McGovern Drive, Melville, NY 11747"}, {"code": "PS#317-1", "lat": 40.8203973, "lon": -73.4078002, "address": "270 McGovern Drive, Melville, NY 11747"}];
    const map = L.map('map').setView([40.730889, -73.284654], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: 'Â© OpenStreetMap contributors' }).addTo(map);

    const select = document.getElementById('stationSelect');
    const markers = [];
    stations.forEach((st, idx) => {
      const marker = L.marker([st.lat, st.lon]).addTo(map)
        .bindPopup(`<strong>${st.code}</strong><br>${st.address}
          <br><a href="https://www.google.com/maps/dir/?api=1&destination=${st.lat},${st.lon}"
          target="_blank">Navigate</a>`);
      markers.push(marker);
      const option = document.createElement('option');
      option.value = idx;
      option.text = `${st.code} - ${st.address}`;
      select.appendChild(option);
    });
    select.addEventListener('change', () => {
      const idx = select.value;
      if(idx === "") return;
      const st = stations[idx];
      map.setView([st.lat, st.lon], 17);
      markers[idx].openPopup();
    });
  </script>
</body>
</html>